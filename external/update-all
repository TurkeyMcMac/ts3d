#!/bin/sh
#
# Sync all the external projects with the versions hosted on Github and update
# various source files accordingly.

cd "`dirname "$0"`"

for project in ./*/; do
	name="`basename "$project"`"
	echo "Updating $name"
	url="`head -n1 "$project/FETCH"`"
	sed '1d' "$project/FETCH" | while read filename; do
		path="$project/$filename"
		mkdir -p "`dirname "$path"`"
		curl -s "$url/$filename" > "$path"
		cd ../src
		case "$filename" in
			*.[ch]) ln -fs "../external/$path" ;;
			*) ;;
		esac
		cd ../external
	done &
done
wait
